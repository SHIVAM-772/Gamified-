<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Number Quest Adventure - Class 4 Maths</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    :root {
      --bg-primary: #212121;
      --bg-secondary: #424242;
      --bg-tertiary: #616161;
      --text-primary: #ffffff;
      --text-secondary: #bdbdbd;
      --accent-primary: #ff5252;
      --accent-secondary: #ff1744;
      --glass-bg: rgba(33, 33, 33, 0.7);
      --glass-border: rgba(255, 82, 82, 0.3);
      --success: #10b981;
      --error: #ef4444;
      --quest-bg: rgba(255, 255, 255, 0.05);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
      min-height: 100vh;
      color: var(--text-primary);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
    }

    .game-container {
      max-width: 800px;
      width: 100%;
      padding: 2rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    #progress {
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: var(--text-secondary);
    }

    #question {
      font-size: 1.5rem;
      margin: 1rem 0;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .option-btn {
      padding: 1rem;
      background: var(--quest-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .option-btn:hover {
      transform: translateY(-3px);
      border-color: var(--accent-primary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #feedback {
      font-size: 1.1rem;
      margin: 1rem 0;
      min-height: 24px;
    }

    #feedback.success {
      color: var(--success);
    }

    #feedback.error {
      color: var(--error);
    }

    .back-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: var(--bg-primary);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease;
    }

    .back-btn:hover {
      transform: scale(1.05);
    }

    @media (max-width: 768px) {
      .game-container {
        padding: 1.5rem;
      }

      h1 {
        font-size: 2rem;
      }

      #question {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>Number Quest Adventure</h1>
    <p id="progress">Level 1 | Power Points: 0</p>
    <p id="question">Loading question...</p>
    <div class="options" id="options"></div>
    <p id="feedback"></p>
    <button class="back-btn" id="backBtn">Back to Hub</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBPMlHzrEOLXOWZldw6fkk5nWf1m0g45L8",
      authDomain: "studentportal-bc1ec.firebaseapp.com",
      projectId: "studentportal-bc1ec",
      storageBucket: "studentportal-bc1ec.firebasestorage.app",
      messagingSenderId: "516315325736",
      appId: "1:516315325736:web:21a4418f69f3f6019fdc1d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const progress = document.getElementById('progress');
    const questionElement = document.getElementById('question');
    const optionsElement = document.getElementById('options');
    const feedbackElement = document.getElementById('feedback');
    const backBtn = document.getElementById('backBtn');

    let currentUser = null;
    let level = 1;
    let points = 0;
    let currentQuestion = null;

    const questions = [
      // Original Questions
      { question: "What is 12 + 8?", answer: "20", options: ["18", "20", "22", "24"] },
      { question: "What is 15 × 3?", answer: "45", options: ["30", "45", "60", "75"] },
      { question: "What is 48 ÷ 4?", answer: "12", options: ["10", "12", "14", "16"] },
      { question: "What is 3/4 of 16?", answer: "12", options: ["8", "10", "12", "14"] },
      { question: "What is 100 - 42?", answer: "58", options: ["52", "58", "62", "68"] },
      // New Questions
      { question: "What is 125 + 75?", answer: "200", options: ["150", "200", "225", "250"] },
      { question: "What is 340 + 160?", answer: "500", options: ["400", "450", "500", "550"] },
      { question: "What is the sum of 56 and 44?", answer: "100", options: ["90", "100", "110", "120"] },
      { question: "What is 250 - 60?", answer: "190", options: ["180", "190", "200", "210"] },
      { question: "What is 500 take away 150?", answer: "350", options: ["300", "350", "400", "450"] },
      { question: "What is 98 - 35?", answer: "63", options: ["53", "63", "73", "83"] },
      { question: "What is 9 × 8?", answer: "72", options: ["64", "72", "81", "90"] },
      { question: "What is 12 × 12?", answer: "144", options: ["120", "132", "144", "156"] },
      { question: "What is 25 × 4?", answer: "100", options: ["75", "100", "125", "150"] },
      { question: "What is 81 ÷ 9?", answer: "9", options: ["7", "8", "9", "10"] },
      { question: "What is 100 ÷ 5?", answer: "20", options: ["15", "20", "25", "30"] },
      { question: "How many groups of 6 are in 54?", answer: "9", options: ["7", "8", "9", "10"] },
      { question: "What is 1/2 of 50?", answer: "25", options: ["20", "25", "30", "35"] },
      { question: "Which fraction is bigger: 1/3 or 1/4?", answer: "1/3", options: ["1/3", "1/4", "They are equal", "Cannot tell"] },
      { question: "What is 2/5 of 25?", answer: "10", options: ["5", "10", "15", "20"] },
      { question: "How many sides does a hexagon have?", answer: "6", options: ["5", "6", "7", "8"] },
      { question: "What is a shape with 4 equal sides and 4 right angles?", answer: "Square", options: ["Rectangle", "Square", "Triangle", "Circle"] },
      { question: "How many corners does a cube have?", answer: "8", options: ["4", "6", "8", "12"] },
      { question: "How many minutes are in one hour?", answer: "60", options: ["30", "60", "90", "120"] },
      { question: "How many centimeters are in a meter?", answer: "100", options: ["10", "50", "100", "1000"] },
      { question: "If it's 3:15 PM, what time will it be in 30 minutes?", answer: "3:45 PM", options: ["3:30 PM", "3:45 PM", "4:00 PM", "4:15 PM"] },
      { question: "Ria has 5 boxes of pencils. Each box has 10 pencils. How many pencils does she have?", answer: "50", options: ["15", "40", "50", "60"] },
      { question: "A bus has 45 seats. 28 seats are taken. How many seats are empty?", answer: "17", options: ["15", "17", "23", "73"] },
      { question: "Sam read 15 pages on Monday and 20 pages on Tuesday. How many pages did he read in all?", answer: "35", options: ["25", "30", "35", "45"] },
      { question: "There are 36 cookies to be shared equally among 4 friends. How many cookies does each friend get?", answer: "9", options: ["6", "8", "9", "12"] }
    ];

    function loadQuestion() {
      currentQuestion = questions[Math.floor(Math.random() * questions.length)];
      questionElement.textContent = currentQuestion.question;
      optionsElement.innerHTML = '';
      currentQuestion.options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.addEventListener('click', () => checkAnswer(option));
        optionsElement.appendChild(btn);
      });
    }

    function checkAnswer(selected) {
      if (selected === currentQuestion.answer) {
        points += 10;
        feedbackElement.textContent = "Correct! +10 Power Points!";
        feedbackElement.className = 'success';
        if (points >= level * 50) {
          level++;
          feedbackElement.textContent += ` You've reached Level ${level}!`;
        }
        progress.textContent = `Level ${level} | Power Points: ${points}`;
        saveProgress();
        setTimeout(loadQuestion, 1000);
      } else {
        feedbackElement.textContent = `Try again! Hint: Think about the numbers in the question.`;
        feedbackElement.className = 'error';
      }
      setTimeout(() => {
        feedbackElement.textContent = '';
        feedbackElement.className = '';
      }, 2000);
    }

    async function saveProgress() {
      if (currentUser) {
        await setDoc(doc(db, 'students', currentUser.uid, 'games', 'numberQuest'), {
          level: level,
          points: points,
          lastPlayed: new Date()
        }, { merge: true });
      }
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        const docRef = doc(db, 'students', user.uid, 'games', 'numberQuest');
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          level = data.level || 1;
          points = data.points || 0;
          progress.textContent = `Level ${level} | Power Points: ${points}`;
        }
        loadQuestion();
      } else {
        window.location.href = 'student.html';
      }
    });

    backBtn.addEventListener('click', () => {
      window.location.href = 'study.html';
    });

    document.addEventListener('DOMContentLoaded', loadQuestion);
  </script>
</body>
</html>